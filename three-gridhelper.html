<!--
Copyright 2012 Flux Factory, Inc.
-->

<!-- TODO(aki): documentation -->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="three.html">

<polymer-element name="three-gridhelper" attributes="width size opacity visible color1 color2 orientation">
  <script type="text/javascript">
    Polymer({

      width: 10,
      size: 10,
      opacity: 1,
      visible: true,
      // Primary line color
      color1: new THREE.Color(0x111111),
      // Secondary line color
      color2: new THREE.Color(0xaaaaaa),

      observe: {
        'width size opacity visible color1 color2': 'update'
      },

      ready: function() {

        this.mesh = new THREE.GridHelper(this.size * this.width, this.size);
        this.plane = new THREE.Mesh(
          new THREE.PlaneGeometry(1000000, 1000000, 2, 2),
          new THREE.MeshBasicMaterial({side: THREE.DoubleSide}));
        this.update();

      },

      orientationChanged: function() {
        switch (this.orientation) {
          case 'xz':
            this.mesh.rotation.set(0, 0, 0);
            this.plane.rotation.set(Math.PI / 2, 0, 0);
            break;
          case 'xy':
            this.mesh.rotation.set(Math.PI / 2, 0, 0);
            this.plane.rotation.set(0, 0, 0);
            break;
          case 'yz':
            this.mesh.rotation.set(0, 0, Math.PI / 2);
            this.plane.rotation.set(0, Math.PI / 2, 0);
            break;
        }

        this.mesh.updateMatrixWorld();
        this.plane.updateMatrixWorld();

      },

      update: function() {
        var gridhelper = new THREE.GridHelper(this.size * this.width, this.size);
        gridhelper.setColors(this.color1, this.color2);
        this.mesh.geometry = gridhelper.geometry;
        this.mesh.material = gridhelper.material;
        this.mesh.geometry.verticesNeedUpdate = true;
        this.mesh.visible = this.visible;
        this.mesh.material.transparent = true;
        this.mesh.material.opacity = this.opacity;
        this.mesh.__webglInit = undefined;
      }

    });

  </script>
</polymer-element>