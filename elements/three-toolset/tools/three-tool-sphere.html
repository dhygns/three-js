<!-- <link rel="import" href="../../three.html"> -->
<link rel="import" href="three-tool.html">

<!--
@element three-tool-sphere
-->

<polymer-element name="three-tool-sphere" extends="three-tool">
  <script>
  (function(){

    var point;
    var distance;
    var sphereHelper = new THREE.Mesh(
      new THREE.SphereGeometry(1, 32, 32),
      new THREE.MeshBasicMaterial({color: 0xffffff})
    );

    Polymer({

      cancel: function() {
        if (sphereHelper.parent) sphereHelper.parent.remove(sphereHelper);
        this.super();
      },

      onDown: function(event) {
        if (!event.pointOnPlane) return;
        this.helperScene.add(sphereHelper);
        sphereHelper.scale.set(1, 1, 1);
        sphereHelper.position.copy(event.pointOnPlane);
        point = event.pointOnPlane.clone();
      },

      onMouseMove: function(event) {
        this.fire('io-help-message',
          'Marker Tool: <b>Click</b> or <b>drag</b> to add marker. Hold <b>Shift</b> to snap.');
        if (!event.pointOnPlane || !point) return;
        distance = point.distanceTo(event.pointOnPlane);
        sphereHelper.scale.set(distance, distance, distance);
      },

      onUp: function(event) {
        var newSphere = new THREE.Mesh(
          new THREE.SphereGeometry(1, 32, 32),
          new THREE.MeshLambertMaterial({color: 0xffffff, wireframe: true})
        );
        newSphere.name = 'marker'; //TODO: increment
        newSphere.position.copy(sphereHelper.position);
        newSphere.scale.copy(sphereHelper.scale);
        this.scene.add(newSphere);
        if (sphereHelper.parent) sphereHelper.parent.remove(sphereHelper);
        point = null;
        distance = null;
        this.cancel(); // TODO: debug
      }
    });
  }());
  </script>
</polymer-element>