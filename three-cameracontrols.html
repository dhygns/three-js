<!--
Copyright 2012 Flux Factory, Inc.
-->

<!-- TODO(aki): documentation -->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="three.html">

<polymer-element name="three-cameracontrols" attributes="camera mode domElement enabled">
  <script type="text/javascript">
    Polymer({

      camera: null,
      mode: null,
      domElement: null,

      ready: function() {
        if (!this.domElement) {
          console.error('three-cameracontrols requires a domElement attribute');
        }
      },

      domElementChanged: function() {
        if (!this.camera) {
          console.error('three-cameracontrols requires a camera attribute');
        }
        // TODO(aki): implement other controls. E.g. first person etc.
        this.orbitControls = new THREE.OrbitControls(this.camera, this.domElement);
        this.getTarget();
      },

      getTarget: function() {
        // Make sure target is persistent when switching cameras and dom Elements
        if (!this.camera.target) {
          this.camera.target = this.orbitControls.target;
        } else {
          this.orbitControls.target = this.camera.target;
          this.orbitControls.update();
        }
      },

      enabledChanged: function() {
        this.orbitControls.enabled = this.enabled;
      },

      cameraChanged: function() {
        this.orbitControls.enabled = false;
        this.orbitControls = new THREE.OrbitControls(this.camera, this.domElement);
        
        if (this.camera instanceof THREE.OrthographicCamera) {
          this.orbitControls.noRotate = true;
        } else if (this.camera instanceof THREE.PerspectiveCamera) {
          this.orbitControls.noRotate = false;
        }
        this.getTarget();

        this.orbitControls.addEventListener('change', function(event) {
          this.fire('change');
        }.bind(this));
        // TODO(aki): implement camera change
      }
    });

  </script>
</polymer-element>